<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>图片裁剪</title>
    <style>
      .preview-wrap {
        position: relative;
      }
      #select-box {
        width: 200px;
        height: 200px;
        border: 1px solid red;
        position: absolute;
        display: none;
        cursor: move;
      }
    </style>
  </head>
  <body>
    <input class="input" type="file" accept="image/*" />
    <div class="preview-wrap">
      <img class="preview" />
      <div id="select-box"></div>
    </div>

    <canvas id="canvas"></canvas>
  </body>
  <script src="./index.js"></script>
  <script>
    const input = document.querySelector("input");
    const preview = document.querySelector(".preview");
    const selectBox = document.querySelector("#select-box");

    const image = new Image();
    let imageW, imageH;

    // 获取canvas的上下文
    const canvas = document.querySelector("#canvas");
    const ctx = canvas.getContext("2d");

    // 裁剪选择框的位置和大小
    let trimPosition = {
      startX: 50,
      startY: 50,
      width: 100,
      height: 100
    };

    // 上传图片的回调
    input.onchange = (e) => {
      const file = e.target.files[0];
      // 图片预览
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = (e) => {
        image.onload = () => {
          console.log(image.offsetTop);
          // 通过Image 获取图片宽高
          imageW = image.width;
          imageH = image.height;
          //   drawImage();
          // 图片加载完成
          selectBox.style.display = "block";
          // 把区域选择框放到 img 上
          selectBox.style.top = image.offsetTop + "px";
          selectBox.style.left = image.offsetLeft + "px";
        };
        image.src = e.target.result;
        preview.src = e.target.result;
      };
    };

    selectBox.addEventListener("mousedown", (e) => {
      console.log("点击");
      document.onmousemove = () => {
        console.log("移动");
      };
    });

    document.onmouseup = () => {
      document.onmousemove = null;
    };

    // 利用canvas 绘制图片
    // function drawImage() {
    //   // 设置canvas宽高和图片一致
    //   canvas.width = imageW;
    //   canvas.height = imageH;
    //   // c.clearRect(0, 0, imageW, imageH);
    //   ctx.drawImage(image, 0, 0);
    //   drawTrim();
    // }

    // // 绘制裁剪选择框
    // function drawTrim() {
    //   // 绘制蒙层
    //   ctx.save();
    //   ctx.fillStyle = "rgba(0,0,0,0.6)";
    //   ctx.fillRect(0, 0, canvas.width, canvas.height);

    //   // 将蒙层凿开
    //   ctx.globalCompositeOPeration = "source-atop";
    //   ctx.clearRect(trimPosition.startX, trimPosition.startY, trimPosition.width, trimPosition.height);

    //   // 绘制4个边框像素点
    //   ctx.globalCompositeOPeration = "source-over";
    //   ctx.fillStyle = "#fc178f";
    //   let size = 10; // 像素点大小
    //   ctx.fillRect(trimPosition.startX - size / 2, trimPosition.startY - size / 2, size, size);
    //   ctx.fillRect(trimPosition.startX + trimPosition.width - size / 2, trimPosition.startY - size / 2, size, size);
    //   ctx.fillRect(trimPosition.startX - size / 2, trimPosition.startY + trimPosition.height - size / 2, size, size);
    //   ctx.fillRect(
    //     trimPosition.startX + trimPosition.width - size / 2,
    //     trimPosition.startY + trimPosition.height - size / 2,
    //     size,
    //     size
    //   );
    //   ctx.restore();

    //   //   ctx.save();
    //   //   ctx.globalCompositeOPeration = "destination-over";
    //   //   ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    //   //   ctx.restore();

    //   console.log(ctx.isPointInPath(30, 70));
    // }

    // canvas.addEventListener("mousemove", (e) => {
    //   if (
    //     trimPosition.startX <= e.offsetX &&
    //     e.offsetX <= trimPosition.width + trimPosition.startX &&
    //     trimPosition.startY <= e.offsetY &&
    //     e.offsetY <= trimPosition.height + trimPosition.startY
    //   ) {
    //     body.style.cursor = "move";
    //   } else {
    //     body.style.cursor = "default";
    //   }
    // });

    // canvas.addEventListener("mouseup", (e) => {
    //   console.log("松开");
    // });
  </script>
</html>
